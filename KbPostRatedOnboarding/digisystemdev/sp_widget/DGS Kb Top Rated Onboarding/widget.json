{
    "instance": {
        "name": "digisystemdev",
        "url": "https://digisystemdev.service-now.com",
        "g_ck": "a99251e01b1a051056252fc13b4bcb83d34441d29f4623031cfb9bc8aa174156de6435c1"
    },
    "action": "saveWidget",
    "tableName": "sp_widget",
    "name": "DGS: Kb Top Rated Onboarding",
    "sys_id": "bad46d191b1a491056252fc13b4bcb8b",
    "widget": {
        "template": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Modelo de HTML do corpo",
            "sys_readonly": false,
            "type": "html_template",
            "mandatory": false,
            "displayValue": "<div class=\"panel panel-{{options.color}} b\" ng-if=\"::(data.articles.length > 0)\">\n  <div class=\"panel-heading\"> <h2 class=\"h4 panel-title\" id=\"header-{{data.sysId}}\">\n    <fa ng-if=\"::options.glyph.length\" name=\"{{::options.glyph}}\" class=\"m-r-sm\" ></fa> {{::options.title}}</h2>\n  </div>\n  <div class=\"panel-body\">\n    <ul class=\"list-group\" aria-labelledby=\"header-{{data.sysId}}\">\n      <li class=\"list-group-item\" ng-repeat=\"a in ::data.articles\">\n        <a href=\"?id=kb_article&sys_id={{::a.sys_id}}\" aria-label=\"{{::a.ratingAriaLabel}}\">{{::a.short_description}}</a>\n        <div>\n          <span uib-rating sp-rating ng-model=\"::a.rating\" max=\"5\" readonly=\"true\" aria-hidden=\"true\" state-on=\"'fa fa-star kb-star-on'\" state-off=\"'fa fa-star kb-star-off'\" />\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n",
            "readonly": false,
            "hint": "",
            "name": "template",
            "attributes": {},
            "choice": 0,
            "value": "<div class=\"panel panel-{{options.color}} b\" ng-if=\"::(data.articles.length > 0)\">\n  <div class=\"panel-heading\"> <h2 class=\"h4 panel-title\" id=\"header-{{data.sysId}}\">\n    <fa ng-if=\"::options.glyph.length\" name=\"{{::options.glyph}}\" class=\"m-r-sm\" ></fa> {{::options.title}}</h2>\n  </div>\n  <div class=\"panel-body\">\n    <ul class=\"list-group\" aria-labelledby=\"header-{{data.sysId}}\">\n      <li class=\"list-group-item\" ng-repeat=\"a in ::data.articles\">\n        <a href=\"?id=kb_article&sys_id={{::a.sys_id}}\" aria-label=\"{{::a.ratingAriaLabel}}\">{{::a.short_description}}</a>\n        <div>\n          <span uib-rating sp-rating ng-model=\"::a.rating\" max=\"5\" readonly=\"true\" aria-hidden=\"true\" state-on=\"'fa fa-star kb-star-on'\" state-off=\"'fa fa-star kb-star-off'\" />\n        </div>\n      </li>\n    </ul>\n  </div>\n</div>\n",
            "max_length": 65000,
            "ed": {
                "name": "template"
            }
        },
        "css": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "CSS",
            "sys_readonly": false,
            "type": "css",
            "mandatory": false,
            "displayValue": ".transclude:last-child {\n  padding-bottom: 10px;\n}\n\n.list-group {\n \tmargin-bottom: 0px; \n}\n\n.list-group-item {\n    padding: 0;\n    border: none;\n    margin-bottom: 10px;\n    border-radius: 0px;\n}\n\n.list-group-item:last-child {\n\tmargin-bottom: 0px;\n}\n\n@media screen and (-ms-high-contrast: active) {\n  .panel-body .list-group .list-group-item .glyphicon-star {\n    color: windowText !important;\n  }\n}\n\n.kb-star-on {\n  color: $fav-star-color !important;\n  text-shadow: $fav-star-outline;\n}\n\n.kb-star-off {\n  color: $fav-star-color-off !important;\n  text-shadow: $fav-star-outline;\n}",
            "readonly": false,
            "hint": "",
            "name": "css",
            "attributes": {},
            "choice": 0,
            "value": ".transclude:last-child {\n  padding-bottom: 10px;\n}\n\n.list-group {\n \tmargin-bottom: 0px; \n}\n\n.list-group-item {\n    padding: 0;\n    border: none;\n    margin-bottom: 10px;\n    border-radius: 0px;\n}\n\n.list-group-item:last-child {\n\tmargin-bottom: 0px;\n}\n\n@media screen and (-ms-high-contrast: active) {\n  .panel-body .list-group .list-group-item .glyphicon-star {\n    color: windowText !important;\n  }\n}\n\n.kb-star-on {\n  color: $fav-star-color !important;\n  text-shadow: $fav-star-outline;\n}\n\n.kb-star-off {\n  color: $fav-star-color-off !important;\n  text-shadow: $fav-star-outline;\n}",
            "max_length": 8000,
            "ed": {
                "name": "css"
            }
        },
        "roles": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Funções",
            "sys_readonly": false,
            "type": "user_roles",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "roles",
            "attributes": {
                "no_truncate": "true",
                "update_exempt": "true",
                "record_watcher_blacklist": "true"
            },
            "choice": 0,
            "value": "",
            "max_length": 255,
            "ed": {
                "name": "roles"
            }
        },
        "link": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Link",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "function link(scope, element, attrs, controller) {\r  \r}",
            "readonly": false,
            "hint": "",
            "name": "link",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "function link(scope, element, attrs, controller) {\r  \r}",
            "max_length": 65000,
            "ed": {
                "name": "link"
            }
        },
        "description": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Descrição",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "Define o que o widget faz",
            "name": "description",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "",
            "max_length": 300,
            "ed": {
                "name": "description"
            }
        },
        "demo_data": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Dados de Demonstração",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "demo_data",
            "attributes": {},
            "choice": 0,
            "value": "",
            "max_length": 8000,
            "ed": {
                "name": "demo_data"
            }
        },
        "option_schema": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Esquema de opções",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "[{\"name\":\"max_number\",\"section\":\"Presentation\",\"label\":\"Max number\",\"type\":\"integer\"},{\"displayValue\":\"Knowledge Category\",\"name\":\"kb_category\",\"section\":\"Data\",\"label\":\"KB category\",\"type\":\"reference\",\"value\":\"kb_category\",\"ed\":{\"reference\":\"kb_category\"}}]",
            "readonly": false,
            "hint": "",
            "name": "option_schema",
            "attributes": {},
            "choice": 0,
            "value": "[{\"name\":\"max_number\",\"section\":\"Presentation\",\"label\":\"Max number\",\"type\":\"integer\"},{\"displayValue\":\"Knowledge Category\",\"name\":\"kb_category\",\"section\":\"Data\",\"label\":\"KB category\",\"type\":\"reference\",\"value\":\"kb_category\",\"ed\":{\"reference\":\"kb_category\"}}]",
            "max_length": 8000,
            "ed": {
                "name": "option_schema"
            }
        },
        "script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Script do servidor",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "(function() {\n\tdata.articles = [];\n\toptions.title = options.title || gs.getMessage(\"Top Rated Articles\");\n\t\n\tvar z;\n\tvar knowledge_bases;\n\tvar sys_id = $sp.getParameter('sys_id');\n\tvar kb_id = $sp.getParameter('kb_id');\n\tvar gr = new GlideRecord(\"kb_knowledge\");\n\tdata.sysId = sys_id;\n\t\n\tvar foundArticle = false;\n\tif (sys_id) { // sys_id specified, try to find an article by sys_id or number\n\t\tgr.addQuery(\"sys_id\", sys_id).addOrCondition(\"number\", sys_id);\n\t\tgr.query();\n\t\tif (gr.next() && gr.canRead()) {\n\t\t\t// When sys_id matches a kb_record, get KB of the article\n\t\t\tknowledge_bases = String(gr.getValue('kb_knowledge_base'));\n\t\t\tfoundArticle = true;\n\t\t}\n\t}\n\t\n\tif (!foundArticle) { /* For all other pages this code will get executed. Used on knowledge home page.*/\n\t\t/*If KB is selected display top rated articles only from that KB*/\n\t\tif (kb_id != null)\n\t\t\tknowledge_bases = String(kb_id);\n\t\telse {\n\t\t\t/*Get all knowledge bases associated with Portal*/\n\t\t\tknowledge_bases = String($sp.getKnowledgeBases());\n\t\t}\n\t}\n\t\n\tif (GlideStringUtil.notNil(knowledge_bases))\n\t\tz = $sp.getAllKBRecords(knowledge_bases);\n\telse //If there are no accessible KBs for logged in user\n\t\treturn;\n\t\n\tz.addQuery(\"rating\", \">\", \"0\");\n\tif (options.kb_category)\n\t\tz.addQuery(\"kb_category\", options.kb_category);\n\tz.orderByDesc('rating');\n\tz.setLimit(options.max_number || 5);\n\tz.query();\n\twhile (z.next()) {\n\t\tif (!z.canRead())\n\t\t\tcontinue;\n\n\t\tvar a = {};\n\t\t$sp.getRecordValues(a, z, 'short_description,sys_view_count,sys_id,published,rating');\n\t\ta.published_display = z.getDisplayValue(\"published\");\n\t\ta.rating = Math.round(a.rating);\n\t\ta.ratingAriaLabel = gs.getMessage('Article, {0}, {1} star rating', [z.short_description, z.rating]);\n\t\tdata.articles.push(a);\n\t}\n})();\n",
            "readonly": false,
            "hint": "",
            "name": "script",
            "attributes": {},
            "choice": 0,
            "value": "(function() {\n\tdata.articles = [];\n\toptions.title = options.title || gs.getMessage(\"Top Rated Articles\");\n\t\n\tvar z;\n\tvar knowledge_bases;\n\tvar sys_id = $sp.getParameter('sys_id');\n\tvar kb_id = $sp.getParameter('kb_id');\n\tvar gr = new GlideRecord(\"kb_knowledge\");\n\tdata.sysId = sys_id;\n\t\n\tvar foundArticle = false;\n\tif (sys_id) { // sys_id specified, try to find an article by sys_id or number\n\t\tgr.addQuery(\"sys_id\", sys_id).addOrCondition(\"number\", sys_id);\n\t\tgr.query();\n\t\tif (gr.next() && gr.canRead()) {\n\t\t\t// When sys_id matches a kb_record, get KB of the article\n\t\t\tknowledge_bases = String(gr.getValue('kb_knowledge_base'));\n\t\t\tfoundArticle = true;\n\t\t}\n\t}\n\t\n\tif (!foundArticle) { /* For all other pages this code will get executed. Used on knowledge home page.*/\n\t\t/*If KB is selected display top rated articles only from that KB*/\n\t\tif (kb_id != null)\n\t\t\tknowledge_bases = String(kb_id);\n\t\telse {\n\t\t\t/*Get all knowledge bases associated with Portal*/\n\t\t\tknowledge_bases = String($sp.getKnowledgeBases());\n\t\t}\n\t}\n\t\n\tif (GlideStringUtil.notNil(knowledge_bases))\n\t\tz = $sp.getAllKBRecords(knowledge_bases);\n\telse //If there are no accessible KBs for logged in user\n\t\treturn;\n\t\n\tz.addQuery(\"rating\", \">\", \"0\");\n\tif (options.kb_category)\n\t\tz.addQuery(\"kb_category\", options.kb_category);\n\tz.orderByDesc('rating');\n\tz.setLimit(options.max_number || 5);\n\tz.query();\n\twhile (z.next()) {\n\t\tif (!z.canRead())\n\t\t\tcontinue;\n\n\t\tvar a = {};\n\t\t$sp.getRecordValues(a, z, 'short_description,sys_view_count,sys_id,published,rating');\n\t\ta.published_display = z.getDisplayValue(\"published\");\n\t\ta.rating = Math.round(a.rating);\n\t\ta.ratingAriaLabel = gs.getMessage('Article, {0}, {1} star rating', [z.short_description, z.rating]);\n\t\tdata.articles.push(a);\n\t}\n})();\n",
            "max_length": 65000,
            "ed": {
                "name": "script"
            }
        },
        "has_preview": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Tem visualização",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "\"verdadeiro\"",
            "readonly": false,
            "hint": "Define se a visualização de dados está disponível",
            "name": "has_preview",
            "attributes": {},
            "choice": 0,
            "value": "true",
            "max_length": 40,
            "ed": {
                "name": "has_preview"
            }
        },
        "public": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Público(a)",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "\"verdadeiro\"",
            "readonly": false,
            "hint": "Widget publicamente disponível para usuários não autenticados",
            "name": "public",
            "attributes": {
                "update_exempt": "true"
            },
            "choice": 0,
            "value": "true",
            "max_length": 40,
            "ed": {
                "name": "public"
            }
        },
        "docs": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "update_synch": "true",
                "synch_attachments": "true"
            },
            "dbType": 12,
            "label": "Documentos",
            "sys_readonly": false,
            "type": "reference",
            "mandatory": false,
            "refTable": "sp_documentation",
            "reference_type": "table",
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "docs",
            "attributes": {
                "encode_utf8": "false"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": false,
            "choice": 0,
            "value": "",
            "max_length": 32,
            "ed": {
                "reference": "sp_documentation",
                "searchField": "title",
                "defaultOperator": "STARTSWITH",
                "name": "docs"
            }
        },
        "client_script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Controlador do cliente",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "api.controller=function() {\r  /* widget controller */\r  var c = this;\r};",
            "readonly": false,
            "hint": "",
            "name": "client_script",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "api.controller=function() {\r  /* widget controller */\r  var c = this;\r};",
            "max_length": 8000,
            "ed": {
                "name": "client_script"
            }
        },
        "data_table": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "default_value": "sp_instance",
            "label": "Tabela de dados",
            "sys_readonly": false,
            "type": "table_name",
            "mandatory": true,
            "displayValue": "sp_instance",
            "readonly": false,
            "hint": "",
            "name": "data_table",
            "attributes": {
                "base_table": "sp_instance",
                "base_start": "true"
            },
            "choice": 0,
            "choices": [],
            "value": "sp_instance",
            "max_length": 80,
            "ed": {
                "name": "data_table"
            }
        },
        "name": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "label": "Nome",
            "sys_readonly": false,
            "type": "translated_field",
            "mandatory": true,
            "displayValue": "DGS: Kb Top Rated Onboarding",
            "readonly": false,
            "hint": "",
            "name": "name",
            "attributes": {},
            "choice": 0,
            "value": "DGS: Kb Top Rated Onboarding",
            "max_length": 40,
            "ed": {
                "name": "name"
            }
        },
        "sys_scope": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "metadata_link_exempt": "true"
            },
            "dbType": 12,
            "label": "Aplicativo",
            "sys_readonly": true,
            "type": "reference",
            "mandatory": false,
            "refTable": "sys_scope",
            "reference_type": "table",
            "displayValue": "Global",
            "readonly": true,
            "hint": "Aplicativo que contém este registro",
            "name": "sys_scope",
            "attributes": {
                "list_force_default": "true",
                "readonly_clickthrough": "true",
                "ignore_filter_on_new": "true"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": true,
            "choice": 0,
            "value": "global",
            "max_length": 32,
            "ed": {
                "reference": "sys_scope",
                "searchField": "name",
                "defaultOperator": "STARTSWITH",
                "name": "sys_scope"
            }
        },
        "id": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "ID",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "dgs__kb_top_rated_onboarding",
            "readonly": false,
            "hint": "Identificador de $sp.embedWidget()",
            "name": "id",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "dgs__kb_top_rated_onboarding",
            "max_length": 40,
            "ed": {
                "name": "id"
            }
        },
        "field_list": {
            "sys_mandatory": false,
            "visible": true,
            "dependentField": "data_table",
            "dbType": -1,
            "label": "Campos",
            "sys_readonly": false,
            "type": "field_list",
            "mandatory": false,
            "displayValue": "title,color,glyph",
            "readonly": false,
            "hint": "",
            "name": "field_list",
            "attributes": {
                "is_multi_text": "false"
            },
            "choice": 0,
            "value": "title,color,glyph",
            "max_length": 1000,
            "ed": {
                "dependent_value": "sp_instance",
                "name": "field_list"
            }
        },
        "controller_as": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "controllerAs",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "c",
            "readonly": false,
            "hint": "Nome do identificador para uma referência ao controlador No escopo da diretiva",
            "name": "controller_as",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "c",
            "max_length": 100,
            "ed": {
                "name": "controller_as"
            }
        }
    }
}